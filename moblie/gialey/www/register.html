<!DOCTYPE html>
<html lang="en">
  <!-- Mirrored from www.enableds.com/products/stickymobile/light/pageapp-login.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 28 Oct 2019 11:36:12 GMT -->
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, viewport-fit=cover"
    />
    <title>2101 GiaLey</title>
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i,900,900i|Source+Sans+Pro:300,300i,400,400i,600,600i,700,700i,900,900i"
      rel="stylesheet"
    />
    <link rel="stylesheet" type="text/css" href="styles/style.css" />
    <link rel="stylesheet" type="text/css" href="styles/framework.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="fonts/css/fontawesome-all.min.css"
    />
  </head>
  <body class="theme-light" data-background="none" data-highlight="red2">
    <div id="page">
      <div id="page-preloader">
        <div class="loader-main">
          <div class="preload-spinner border-highlight"></div>
        </div>
      </div>
      <div class="header header-fixed header-logo-center">
        <a href="#" class="header-title">Register</a>
      </div>
      <div class="page-content-black"></div>
      <div class="page-content">
        <div class="cover-wrapper cover-no-buttons">
          <div data-height="cover" class="caption bottom-0">
            <div class="caption-center">
              <div class="left-50 right-50">
                <h1
                  class="color-white center-text uppercase ultrabold fa-3x"
                  style="margin-bottom:20px"
                >
                  Register
                </h1>
                <!-- <p
                  class="color-highlight center-text font-12 under-heading bottom-30"
                >
                  Create an Account. It's 100% free
                </p> -->
                <div
                  class="input-style input-light has-icon input-style-1 input-required"
                >
                  <i class="input-icon fa fa-user font-11"></i>
                  <span>Username</span>
                  <em>(required)</em>
                  <input type="name" id="username_TB" placeholder="Username" />
                </div>
                <div
                  class="input-style input-light has-icon input-style-1 input-required"
                >
                  <i class="input-icon fa fa-user font-11"></i>
                  <span>Age</span>
                  <em>(required)</em>
                  <input type="number" id="age_TB" placeholder="Age" />
                </div>
                <div
                  class="input-style input-light has-icon input-style-1 input-required"
                >
                  <i class="input-icon fa fa-at"></i>
                  <span>Email</span>
                  <em>(required)</em>
                  <input type="email" id="email_TB" placeholder="Email" />
                </div>
                <div
                  class="input-style input-light has-icon input-style-1 input-required"
                >
                  <i class="input-icon fa fa-lock font-11"></i>
                  <span>Password</span>
                  <em>(required)</em>
                  <input
                    type="password"
                    id="password_TB"
                    placeholder="Choose a Password"
                  />
                </div>
                <div
                  class="input-style input-light has-icon input-style-1 input-required"
                >
                  <i class="input-icon fa fa-lock font-11"></i>
                  <span>Password</span>
                  <em>(required)</em>
                  <input
                    type="password"
                    id="cfm_password_TB"
                    placeholder="Confirm your Password"
                  />
                </div>
                <span
                  style="color: red"
                  class="text-center"
                  id="error_LBL"
                ></span>
                <a
                  href="#" onclick="login()"
                  class="color-white opacity-50 text-center font-11"
                  >Already Registered? Sign In here</a
                >
                <script>
                  function login(){
                    window.location.href = "/index.html"
                  }
                </script>
                <a
                  href ="#"
                  id="register_BTN"
                  style="margin:auto"
                  class="button button-full button-m shadow-large button-round-small bg-highlight top-30 bottom-40"
                  >CREATE ACCOUNT</a>
                >
              </div>
            </div>
          </div>
          <div class="caption-overlay bg-black opacity-80"></div>
          <div
            class="caption-bg"
            style="background-image:url(images/pictures/20t.jpg)"
          ></div>
        </div>
      </div>

      <div
        id="menu-settings"
        class="menu menu-box-bottom menu-box-detached round-large"
        data-menu-height="310"
        data-menu-effect="menu-over"
      >
        <div class="content bottom-0">
          <div class="menu-title">
            <h1>Settings</h1>
            <p class="color-highlight">Flexible and Easy to Use</p>
            <a href="#" class="close-menu"><i class="fa fa-times"></i></a>
          </div>
          <div class="divider bottom-20"></div>
          <div class="toggle-with-icon">
            <i
              class="toggle-icon round-tiny fa fa-moon bg-red2-dark color-white"
            ></i>
            <a
              href="#"
              class="toggle-switch toggle-ios toggle-off"
              data-toggle-theme
              data-toggle-height="27"
              data-toggle-width="50"
              data-toggle-content="toggle-content-1"
              data-toggle-checkbox="toggle-checkbox-1"
              data-bg-on="bg-green1-dark"
              data-bg-off=""
            >
              <span class="color-theme regularbold font-13">Dark Mode</span>
              <strong></strong>
              <u></u>
            </a>
          </div>
        </div>
      </div>
    </div>
    <script type="text/javascript" src="scripts/jquery.js"></script>
    <script type="text/javascript" src="scripts/plugins.js"></script>
    <script type="text/javascript" src="scripts/custom.js"></script>
    <!-- <script type="text/javascript" src="database_controller.js"></script> -->

    <script>
      if(localStorage.userID != undefined){
        window.location.href = "/home.html"
      } 
      //  STEPS
      //  1.  Use javascript to check all the input parameters
      //  2.  If successful, save these parameters into a session and move on to the next page.

      // Getting all the IDs of the elements
      var register_BTN = document.getElementById("register_BTN");
      register_BTN.addEventListener("click", submit_form);

      function post_to_server(url_param, post_data) {
        var base_url = "https://ict2101gialey.herokuapp.com/" + url_param;
        console.log("URL to send:" + base_url);
        console.log("Data to send: " + post_data);
        return new Promise(resolve => {
          $.ajax({
            type: "POST",
            url: base_url,
            data: post_data
          }).done(function(data) {
            console.log(data);
            resolve(data);
          });
        });
      }

      async function validate_inputs() {
        var error_LBL = document.getElementById("error_LBL");
        console.log(username_TB.value);
        // Check if every field is filled.
        if (
          username_TB.value == "" ||
          email_TB.value == "" ||
          password_TB.value == "" ||
          cfm_password_TB.value == ""
        ) {
          error_LBL.innerHTML = "Please fill up every field in the form.";
          console.log("Please fill up every field in the form.");
          return false;
        }
        // Check if passwords are the same
        if (password_TB.value != cfm_password_TB.value) {
          error_LBL.innerHTML = "Please ensure that password matches.";
          console.log("Please ensure that passwords are the same.");
          return false;
        }
        // Check if username exists in database.
        var response = await post_to_server("checkUsername/", {"username" : username_TB.value})
        console.log(response["ERROR_CODE"])
        if (response["ERROR_CODE"] != 0){
          error_LBL.innerHTML = "Username exists. Please choose another one.";
          console.log("username exists")
          return false;
        }
        return true;
      }

      async function submit_form() {
        var username_TB = document.getElementById("username_TB");
        var age_TB = document.getElementById("age_TB");
        var email_TB = document.getElementById("email_TB");
        var password_TB = document.getElementById("password_TB");
        var cfm_password_TB = document.getElementById("cfm_password_TB");

        if (await validate_inputs() == false){
          return
        }

        localStorage.username = username_TB.value;
        localStorage.email = email_TB.value;
        localStorage.password = password_TB.value;
        localStorage.age = age_TB.value;


        console.log("All fields are correct.");

        //Redirect to registration OTP Validation page.
        window.location.href = "registration_OTP.html";
        // Save into session
      }
    </script>
  </body>
</html>
