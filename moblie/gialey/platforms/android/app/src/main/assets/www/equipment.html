<!DOCTYPE html>
<html lang="en">
<!-- Mirrored from www.enableds.com/products/stickymobile/light/page-vcard.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 28 Oct 2019 11:36:38 GMT -->

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, viewport-fit=cover" />
    <title>StickyMobile</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i,900,900i|Source+Sans+Pro:300,300i,400,400i,600,600i,700,700i,900,900i" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="styles/style.css" />
    <link rel="stylesheet" type="text/css" href="styles/framework.css" />
    <link rel="stylesheet" type="text/css" href="fonts/css/fontawesome-all.min.css" />

    <style>
         .loader {
  z-index: 9999;
  border: 8px solid #f3f3f3; /* Light grey */
  position: fixed;
  left:50%;
  top: 50%;
  border-top: 8px solid #3498db; /* Blue */
  border-radius: 50%;
  width: 80px;
  height: 80px;
  margin-top: -40px; /* Negative half of height. */
margin-left: -40px; /* Negative half of width. */
  animation: spin 2s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

      .row_div{
        height:60px;
        padding:10px 0px 0px 10px;
        background-color:#263238
      }
    </style>
</head>

<body class="theme-light" data-background="none" data-highlight="red2">
    <div class="loader" id="spinner" style="display:none"></div>
    <div id="page">
        <div id="page-preloader">
            <div class="loader-main">
                <div class="preload-spinner border-highlight"></div>
            </div>
        </div>
        <div class="header header-fixed header-logo-center">
            <a class="header-title">Ongoing Expedition</a>
            <a onclick="back_btn()" class="header-icon header-icon-1"><i class="fas fa-arrow-left"></i
        ></a>
        <a style="margin-right:10px; width:50px;"href="#" data-toggle-theme-switch class="header-icon header-icon-4"
        ><span style="font-weight: 600;" id="H_Token_ICON"></span> <i class="fa fa-coins"></i></a>
        </div>
        <div id="footer-menu" class="footer-menu-5-icons footer-menu-style-1">
            <a onclick="navigation()"><i class="fa fa-map-pin"></i><span>Navigate</span></a>
            <a onclick="expedition()"><i class="fa fa-map"></i><span>Expedition</span></a>
            <a onclick="equipment()"><i class="fa fa-khanda"></i><span>My Hero</span></a>
            <a onclick="marketplace()"><i class="fa fa-shopping-basket"></i><span>Marketplace</span></a>
            <a onclick="rewards()"><i class="fa fa-ticket-alt"></i><span>Rewards</span></a>
            <div class="clear"></div>
            <script>
              function navigation(){
                window.location.href="navigation.html"
              }
              function expedition(){
                window.location.href="expedition.html"
              }
              function equipment(){
                window.location.href="equipment.html"
              }
              function marketplace(){
                window.location.href="marketplace.html"
              }
              function rewards(){
                window.location.href="rewards.html"
              }
            </script>
          </div>
          <div class="loader" id="spinner" style="display:none"></div>
      <div class="page-content header-clear-medium" style="padding-top:50px; padding-bottom:0px" id="expedition_container">

          <!-- IMAGE HOLDER-->
          <div class="content content-box shadow-large" style="padding:20px; margin-bottom:0px; background-color:#263238">
              <img style="height:150px; margin:auto" src="images/game_assets/avatar/Avatar.png"></div>
          <!-- Equipped Equipments-->
          <div style="height:60px; padding-left:10px; padding-bottom: 10px; background-color:#263238">
              <div class="one-third">
                  <div class="one-half" style="height:50px;">
                      <img id="Weapon" onclick="unequip_item()" src="images/game_assets/Empty.png" style="height: 50px;">
                      <input type="hidden" value="unequipped"/>
                  </div>
                  <div class="one-half last-column" style="height:50px;">
                      <img id="Helmet" onclick="unequip_item()" src="images/game_assets/Empty.png" style="height: 50px;">
                      <input type="hidden" value="unequipped"/>
                  </div>
              </div>

              <div class="one-third">
                  <div class="one-half" style="height:50px;">
                      <img id="Armor" onclick="unequip_item()" src="images/game_assets/Empty.png" style="height: 50px;">
                      <input type="hidden" value="unequipped"/>
                  </div>
                  <div class="one-half last-column" style=" height:50px;">
                      <img id="Boots" onclick="unequip_item()" src="images/game_assets/Empty.png" style="height: 50px;">
                      <input type="hidden" value="unequipped"/>
                  </div>
              </div>

              <div class="one-third last-column">
                  <div class="one-half" style="height:50px;">
                      <img id="Cloak" onclick="unequip_item()" src="images/game_assets/Empty.png" style="height: 50px;">
                      <input type="hidden" value="unequipped"/>
                  </div>
                  <div class="one-half last-column" style=" height:50px;">
                      <img id="Necklace" onclick="unequip_item()" src="images/game_assets/Empty.png" style="height: 50px;">
                      <input type="hidden" value="unequipped"/>
                  </div>
              </div>
          </div>
      </div>

      <!-- POWER LEVEL BOX -->
      <div class="content content-box shadow-large" style="height:60px; background-color:#212121; margin-bottom: 0px">
          <div style="color:white">
              <div class="one-half">
                  <span>Power Level: <b id="power_level_lbl"></b></span>
              </div>
              <div class="one-half last-column text-right">
                  <span></span>
              </div>
          </div>
      </div>
      <div style="z-index: 999; background-color:white; height:70px; padding: 8px 15px 10px 15px">
          <div class="one-half" style="height:60px;">
              <div class="input-style input-style-2 input-required">
                  <span>Filter by Rarity</span>
                  <em><i class="fa fa-angle-down"></i></em>
                  <select onchange="filter()" id="rarity_SEL">
                      <option value="default" selected>All</option>
                      <option value="Common">Common</option>
                      <option value="Rare">Rare</option>
                      <option value="Epic">Epic</option>
                      <option value="Legendary">Legendary</option>
                  </select>
              </div>
          </div>
          <div class="one-half last-column" style="height:60px">
              <div class="input-style input-style-2 input-required" style="padding-bottom: 0px">
                  <span>Equipment type</span>
                  <em><i class="fa fa-angle-down"></i></em>
                  <select onchange="filter()" id="type_SEL">
                      <option value="default" selected>All</option>
                      <option value="Helmet">Helmet</option>
                      <option value="Armor">Armor</option>
                      <option value="Cape">Cape</option>
                      <option value="Boots">Boots</option>
                      <option value="Weapons">Weapons</option>
                      <option value="Amulet">Amulet</option>
                  </select>
              </div>
          </div>
      </div>
      <div id="unequipped_section" style="z-index:999"></div>




      <!-- <div style="height:60px; padding:10px 0px 0px 10px; background-color:#263238">
          <div class="one-third">
              <div class="one-half" style="height:50px;">
                  <img src="images/game_assets/equipment/Headgear1.png" style="height: 50px;">
              </div>
              <div class="one-half last-column" style="height:50px;">
                  <img src="images/game_assets/equipment/Headgear1.png" style="height: 50px;">
              </div>
          </div>

          <div class="one-third">
              <div class="one-half" style="height:50px;">
                  <img src="images/game_assets/equipment/Headgear1.png" style="height: 50px;">
              </div>
              <div class="one-half last-column" style=" height:50px;">
                  <img src="images/game_assets/equipment/Headgear1.png" style="height: 50px;">
              </div>
          </div>

          <div class="one-third last-column">
              <div class="one-half" style="height:50px;">
                  <img src="images/game_assets/equipment/Headgear1.png" style="height: 50px;">
              </div>
              <div class="one-half last-column" style=" height:50px;">
                  <img src="images/game_assets/equipment/Headgear1.png" style="height: 50px;">
              </div>
          </div>
      </div> -->

    </div>
    
    <script type="text/javascript" src="scripts/jquery.js"></script>
    <script type="text/javascript" src="scripts/plugins.js"></script>
    <script type="text/javascript" src="scripts/custom.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  
    <script >
       var spinner = document.getElementById("spinner")
        // Fetch items from session variables.
    var equipped_equipment_list = []
    var unequipped_equipment_list = []
    var filtered_equipment_list = []                // Stores only the equipment list for display
    var equipment_list = []
    
    // This is to save the number of calls from the API
    var username = localStorage.username;
      var age = localStorage.age;
      var email = localStorage.email;
      var mobile_number = localStorage.mobile_number;
      var userID = localStorage.userID;
      var h_token = localStorage.h_token;
      document.getElementById("H_Token_ICON").innerHTML = h_token + " ";

      console.log(userID, username, age, email, mobile_number, h_token)
    
    fetch_equipments();
    console.log(userID, username, age, email, mobile_number)
    
    function post_to_server(url_param, post_data) {
      spinner.style.display = "block"
        var base_url = "https://ict2101gialey.herokuapp.com/" + url_param
        console.log("URL to send:" + base_url)
        console.log("Data to send: " + post_data)
        return new Promise(resolve => {
            $.ajax({
                    type: 'POST',
                    url: base_url,
                    data: post_data
                })
                .done(function(data) {
                    spinner.style.display = "none"
                    console.log(data);
                    resolve(data)
                });
        })
    }

    async function unequip_item(){
      equipped_id = event.target.id
      if (document.getElementById(equipped_id).nextElementSibling.value == "unequipped") return
      
      console.log(equipped_id)
      for (var i = 0; i < equipped_equipment_list.length; i++)
      {
        if (equipped_equipment_list[i]["EQUIPMENT_TYPE"] == equipped_id)
        {
          document.getElementById(equipped_id).nextElementSibling.value = "unequipped"
          unequip_confirmation(equipped_equipment_list[i]["NAME"], i)
        }
      }
    }

    async function equip_item(){
      console.log(event.target.id)

      for (var i = 0; i < unequipped_equipment_list.length; i++)
      {
        if (unequipped_equipment_list[i]["EQUIPMENT_ID"] == event.target.id)
        {
          equip_confirmation(unequipped_equipment_list[i]["NAME"], i)
          break;
        }
      }
    }

    // Fetch Equipments
    async function fetch_equipments() {
        console.log("fetch_equipments!")
        var response = await post_to_server("getEquipment/", {
            "userID": userID
        })
        if (response["ERROR_CODE"] == 0) {
            document.getElementById("power_level_lbl").innerHTML = response["POWER_LEVEL"]
            for (var i = 0; i < response["DETAILS"].length; i++)
                equipment_list.push(response["DETAILS"][i])
        }
        console.log(equipment_list)
        for (var i = 0; i < response["DETAILS"].length; i++) {
            if (equipment_list[i]["IS_EQUIPPED"] == 'N'){
                unequipped_equipment_list.push(equipment_list[i])
                filtered_equipment_list.push(equipment_list[i])
                }
            else if (equipment_list[i]["IS_EQUIPPED"] == 'Y')
                equipped_equipment_list.push(equipment_list[i])
        }
        populate_unequipped_equipments()
        populate_equipped_equipments()
    }

    function populate_equipped_equipments(){
        for (var i = 0; i < equipped_equipment_list.length; i++){
          if (equipped_equipment_list[i]["EQUIPMENT_TYPE"] == "Weapon"){
            document.getElementById("Weapon").src = equipped_equipment_list[i]["IMG"]
            document.getElementById("Weapon").nextElementSibling.value = "equipped"
          }
          else if (equipped_equipment_list[i]["EQUIPMENT_TYPE"] == "Armor"){
            document.getElementById("Armor").src = equipped_equipment_list[i]["IMG"] 
            document.getElementById("Armor").nextElementSibling.value = "equipped"
          } 
          else if (equipped_equipment_list[i]["EQUIPMENT_TYPE"] == "Helmet"){
            document.getElementById("Helmet").src = equipped_equipment_list[i]["IMG"]
            document.getElementById("Helmet").nextElementSibling.value = "equipped"
          }  
          else if (equipped_equipment_list[i]["EQUIPMENT_TYPE"] == "Boots"){
            document.getElementById("Boots").src = equipped_equipment_list[i]["IMG"]
            document.getElementById("Boots").nextElementSibling.value = "equipped"
          } 
          else if (equipped_equipment_list[i]["EQUIPMENT_TYPE"] == "Cloak"){
            document.getElementById("Cloak").src = equipped_equipment_list[i]["IMG"]
            document.getElementById("Cloak").nextElementSibling.value = "equipped"
          } 
          else if (equipped_equipment_list[i]["EQUIPMENT_TYPE"] == "Necklace"){
            document.getElementById("Necklace").src = equipped_equipment_list[i]["IMG"]
            document.getElementById("Necklace").nextElementSibling.value = "equipped" 
          }
            
        }
    }

    async function populate_unequipped_equipments() {

            var unequipped_section = document.getElementById("unequipped_section")

            while (unequipped_section.firstChild) {
              unequipped_section.removeChild(unequipped_section.firstChild);
            }

            console.log("Populating filtered equipment list")
            console.log(filtered_equipment_list)
            items = filtered_equipment_list.length
            items_left = items;
            index = 0
            var rows = Math.floor(items / 6) + 1;
            // console.log("rows needed = " + rows)

            for (var i = 0; i < rows; i++){   // Number of rows            
                var row_div = document.createElement("div")
                row_div.classList.add("row_div")

                // Find out how element in this div.
                if (items_left > 6)
                  iterations = 6
                else
                  iterations = items_left

                if (items_left >= 5){
                  var div_1 = document.createElement("div")
                  div_1.classList.add("one-third")

                  var div_2 = document.createElement("div")
                  div_2.classList.add("one-third")

                  var div_3 = document.createElement("div")
                  div_3.classList.add("one-third", "last-column")
                  row_div.appendChild(div_1)
                  row_div.appendChild(div_2)
                  row_div.appendChild(div_3)
                }
                else if (items_left >= 3){
                  var div_1 = document.createElement("div")
                  div_1.classList.add("one-third")

                  var div_2 = document.createElement("div")
                  div_2.classList.add("one-third")
                  row_div.appendChild(div_1)
                  row_div.appendChild(div_2)
                }
                else if (items_left >= 1){
                  var div_1 = document.createElement("div")
                  div_1.classList.add("one-third")
                  row_div.appendChild(div_1)
                }

                for (var j = 0; j < iterations; j ++)
                {
                  // console.log(j)
                  half_div = document.createElement("div")
                  if (j % 2 == 0){
                    half_div.classList.add("one-half")
                  }
                  else{
                    half_div.classList.add("one-half", "last-column") 
                  }
                  img = document.createElement("img")
                  img.src = filtered_equipment_list[index]["IMG"]
                  img.style.height = "50px"
                  img.id = filtered_equipment_list[index]["EQUIPMENT_ID"]
                  img.addEventListener("click", equip_item)

                  half_div.appendChild(img)
                  if (j == 0 ||  j == 1){
                    div_1.appendChild(half_div)
                  }
                  else if (j == 2 ||  j == 3){
                    div_2.appendChild(half_div)
                  }
                  else if (j == 4 || j == 5){
                    div_3.appendChild(half_div)
                  } 
                  index += 1
                }
                items_left -= 6
                unequipped_section.appendChild(row_div)
            }
    }
    

    async function equip_confirmation(equipment_name, unequipped_index){
      console.log(unequipped_index)
      Swal.fire({
      title: equipment_name,
      text: "Do you want to equip this item?",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Equip'
      }).then(async (result) => {
      if (result.value) {

        var item = unequipped_equipment_list[unequipped_index]
        var eq_type = item["EQUIPMENT_TYPE"]
        console.log(eq_type)
        /************** SWAPPING ON SERVER *********************/
        if (document.getElementById(eq_type).nextElementSibling.value == "equipped"){
            console.log(document.getElementById(eq_type).src)
            index = check_equipped_type(eq_type)
            console.log("EQUIPMENT_LIST")
            console.log(equipped_equipment_list)
            console.log(index)
            // SWITCH
            response = await post_to_server('equip_switch/', {"userID": userID, 
            "replaced_equipmentID":equipped_equipment_list[index]["EQUIPMENT_ID"], 
            "equipmentID":unequipped_equipment_list[unequipped_index]["EQUIPMENT_ID"]})
            document.getElementById("power_level_lbl").innerHTML = response["DETAILS"]
        }
        else{
            response = await post_to_server('equip/', {"userID" : userID,
            "equipmentID" : unequipped_equipment_list[unequipped_index]["EQUIPMENT_ID"]})
            document.getElementById("power_level_lbl").innerHTML = response["DETAILS"]
        }
        /*************** SWAPPING ON UI ************************/
    
        response = check_equipped_type(eq_type)
        if (response === false){  // If equipment if not found inside, append
          console.log("No Equipment Exist. Append")
          equipped_equipment_list.push(item)
          unequipped_equipment_list.splice(unequipped_index, 1)
        }
        else {
          console.log("Equipment Exists. Swap")
          unequipped_equipment_list[unequipped_index] = equipped_equipment_list[response] 
          equipped_equipment_list[response] = item
        }
        console.log(equipped_equipment_list)
        console.log(unequipped_equipment_list)
        filter()
        populate_equipped_equipments()
       
        Swal.fire(
          'Equipped Successfully',
          'Lorem Ipsum',
          'success'
        )
      }
      })
      }


    function unequip_confirmation(equipment_name, equipped_index){
      console.log(equipped_index)
      Swal.fire({
      title: equipment_name,
      text: "Do you want to unequip this item?",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Unequip'
      }).then(async (result) => {
      if (result.value) {
        // Set user to set off for expedition     
        // Swap the items from the list.
       
       /****************************** SWAPPING ON SERVER **************************/
       var item = equipped_equipment_list[equipped_index]
        let response = await post_to_server('unequip/', {"userID" : userID, "equipmentID" : item["EQUIPMENT_ID"]})
        document.getElementById("power_level_lbl").innerHTML = response["DETAILS"]
      /******************************** SWAPPING ON UI ******************************/
       
        document.getElementById(item["EQUIPMENT_TYPE"]).src = "images/game_assets/Empty.png"
        equipped_equipment_list.splice(equipped_index, 1)
        unequipped_equipment_list.push(item)
        filter()

        populate_equipped_equipments()
        console.log(equipped_equipment_list)
        console.log(unequipped_equipment_list)
        Swal.fire(
          equipment_name + " unequipped.",
          'Lorem Ipsum',
          'success'
        )
      }
      })
      }

    function check_equipped_type(eq_type){
        var index = 0
        for(var i = 0; i < equipped_equipment_list.length; i++){
          if (equipped_equipment_list[i]["EQUIPMENT_TYPE"] == eq_type)
            return index
          index += 1
        }
        return false
      }
    
    function back_btn(){
      window.location.href = "/home.html"
    }

    function filter(){
      // Rarity Select Box
      var rarity_SEL = document.getElementById("rarity_SEL");
      var rarity = rarity_SEL.options[rarity_SEL.selectedIndex].value;

      // Equipment Type Select Box
      var type_SEL = document.getElementById("type_SEL");
      var type = type_SEL.options[type_SEL.selectedIndex].value;


      filtered_equipment_list = []
      
      // If Type is default
    
      if (type == "default" && rarity == "default"){
        filtered_equipment_list = unequipped_equipment_list
      }
      else if (type == "default"){
        for (var i = 0; i < unequipped_equipment_list.length; i++){
          if (unequipped_equipment_list[i]["RARITY"] == rarity)
          filtered_equipment_list.push(unequipped_equipment_list[i])
        }
      }
      else if (rarity == "default"){
        for (var i = 0; i < unequipped_equipment_list.length; i++){
          if (unequipped_equipment_list[i]["EQUIPMENT_TYPE"] == type)
          filtered_equipment_list.push(unequipped_equipment_list[i])
        }
      }
      else{
        for (var i = 0; i < unequipped_equipment_list.length; i++){
          if (unequipped_equipment_list[i]["RARITY"] == rarity && unequipped_equipment_list[i]["EQUIPMENT_TYPE"] == type)
          filtered_equipment_list.push(unequipped_equipment_list[i])
        }
      }
      console.log("Filtered Equipment List.")
      console.log(filtered_equipment_list)
      populate_unequipped_equipments();
    }
        </script>
</html>
